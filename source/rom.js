JSNES.ROM=function(e){this.nes=e,this.mapperName=new Array(92);for(var r=0;r<92;r++)this.mapperName[r]="Unknown Mapper";this.mapperName[0]="Direct Access",this.mapperName[1]="Nintendo MMC1",this.mapperName[2]="UNROM",this.mapperName[3]="CNROM",this.mapperName[4]="Nintendo MMC3",this.mapperName[5]="Nintendo MMC5",this.mapperName[6]="FFE F4xxx",this.mapperName[7]="AOROM",this.mapperName[8]="FFE F3xxx",this.mapperName[9]="Nintendo MMC2",this.mapperName[10]="Nintendo MMC4",this.mapperName[11]="Color Dreams Chip",this.mapperName[12]="FFE F6xxx",this.mapperName[15]="100-in-1 switch",this.mapperName[16]="Bandai chip",this.mapperName[17]="FFE F8xxx",this.mapperName[18]="Jaleco SS8806 chip",this.mapperName[19]="Namcot 106 chip",this.mapperName[20]="Famicom Disk System",this.mapperName[21]="Konami VRC4a",this.mapperName[22]="Konami VRC2a",this.mapperName[23]="Konami VRC2a",this.mapperName[24]="Konami VRC6",this.mapperName[25]="Konami VRC4b",this.mapperName[32]="Irem G-101 chip",this.mapperName[33]="Taito TC0190/TC0350",this.mapperName[34]="32kB ROM switch",this.mapperName[64]="Tengen RAMBO-1 chip",this.mapperName[65]="Irem H-3001 chip",this.mapperName[66]="GNROM switch",this.mapperName[67]="SunSoft3 chip",this.mapperName[68]="SunSoft4 chip",this.mapperName[69]="SunSoft5 FME-7 chip",this.mapperName[71]="Camerica chip",this.mapperName[78]="Irem 74HC161/32-based",this.mapperName[91]="Pirate HK-SF3 chip"},JSNES.ROM.prototype={VERTICAL_MIRRORING:0,HORIZONTAL_MIRRORING:1,FOURSCREEN_MIRRORING:2,SINGLESCREEN_MIRRORING:3,SINGLESCREEN_MIRRORING2:4,SINGLESCREEN_MIRRORING3:5,SINGLESCREEN_MIRRORING4:6,CHRROM_MIRRORING:7,header:null,rom:null,vrom:null,vromTile:null,romCount:null,vromCount:null,mirroring:null,batteryRam:null,trainer:null,fourScreen:null,mapperType:null,valid:!1,load:function(e){var r,a,i;if(-1!==e.indexOf("NES")){for(this.header=new Array(16),r=0;r<16;r++)this.header[r]=255&e.charCodeAt(r);this.romCount=this.header[4],this.vromCount=2*this.header[5],this.mirroring=1&this.header[6]?1:0,this.batteryRam=!!(2&this.header[6]),this.trainer=!!(4&this.header[6]),this.fourScreen=!!(8&this.header[6]),this.mapperType=this.header[6]>>4|240&this.header[7];var t=!1;for(r=8;r<16;r++)if(0!==this.header[r]){t=!0;break}t&&(this.mapperType&=15),this.rom=new Array(this.romCount);var p,m,h=16;for(r=0;r<this.romCount;r++){for(this.rom[r]=new Array(16384),a=0;a<16384&&!(h+a>=e.length);a++)this.rom[r][a]=255&e.charCodeAt(h+a);h+=16384}for(this.vrom=new Array(this.vromCount),r=0;r<this.vromCount;r++){for(this.vrom[r]=new Array(4096),a=0;a<4096&&!(h+a>=e.length);a++)this.vrom[r][a]=255&e.charCodeAt(h+a);h+=4096}for(this.vromTile=new Array(this.vromCount),r=0;r<this.vromCount;r++)for(this.vromTile[r]=new Array(256),a=0;a<256;a++)this.vromTile[r][a]=new JSNES.PPU.Tile;for(i=0;i<this.vromCount;i++)for(r=0;r<4096;r++)p=r>>4,(m=r%16)<8?this.vromTile[i][p].setScanline(m,this.vrom[i][r],this.vrom[i][r+8]):this.vromTile[i][p].setScanline(m-8,this.vrom[i][r-8],this.vrom[i][r]);this.valid=!0}else this.nes.ui.updateStatus("Not a valid NES ROM.")},getMirroringType:function(){return this.fourScreen?this.FOURSCREEN_MIRRORING:0===this.mirroring?this.HORIZONTAL_MIRRORING:this.VERTICAL_MIRRORING},getMapperName:function(){return this.mapperType>=0&&this.mapperType<this.mapperName.length?this.mapperName[this.mapperType]:"Unknown Mapper, "+this.mapperType},mapperSupported:function(){return void 0!==JSNES.Mappers[this.mapperType]},createMapper:function(){return this.mapperSupported()?new JSNES.Mappers[this.mapperType](this.nes):(this.nes.ui.updateStatus("This ROM uses a mapper not supported by JSNES: "+this.getMapperName()+"("+this.mapperType+")"),null)}};