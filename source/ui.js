JSNES.DummyUI=function(e){this.nes=e,this.enable=function(){},this.updateStatus=function(){},this.writeAudio=function(){},this.writeFrame=function(){}},"undefined"!=typeof jQuery&&function(e){e.fn.JSNESUI=function(t){var n=this,s=function(s){var o=this;o.nes=s,o.root=e("<div></div>"),o.screen=e('<canvas class="nes-screen" width="256" height="240"></canvas>').appendTo(o.root),o.screen[0].getContext?(o.romContainer=e('<div class="nes-roms"></div>').appendTo(o.root),o.romSelect=e("<select></select>").appendTo(o.romContainer),o.controls=e('<div class="nes-controls"></div>').appendTo(o.root),o.buttons={pause:e('<input type="button" value="暂停" class="nes-pause" disabled="disabled">').appendTo(o.controls),restart:e('<input type="button" value="重新开始" class="nes-restart" disabled="disabled">').appendTo(o.controls),sound:e('<input type="button" value="打开声音" class="nes-enablesound">').appendTo(o.controls),zoom:e('<input type="button" value="全屏" class="nes-zoom">').appendTo(o.controls)},o.status=e('<p class="nes-status">Booting up...</p>').appendTo(o.root),o.root.appendTo(n),o.romSelect.change((function(){o.loadROM()})),o.buttons.pause.click((function(){o.nes.isRunning?(o.nes.stop(),o.updateStatus("Paused"),o.buttons.pause.attr("value","继续")):(o.nes.start(),o.buttons.pause.attr("value","暂停"))})),o.buttons.restart.click((function(){o.nes.reloadRom(),o.nes.start()})),o.buttons.sound.click((function(){o.nes.opts.emulateSound?(o.nes.opts.emulateSound=!1,o.buttons.sound.attr("value","打开声音")):(o.nes.opts.emulateSound=!0,o.buttons.sound.attr("value","关闭声音"))})),o.fullscreen=!1,o.buttons.zoom.click((function(){o.fullscreen?(o.exitFullscreen(),o.buttons.zoom.attr("value","全屏"),o.fullscreen=!1):(o.enterFullscreen(),o.buttons.zoom.attr("value","退出全屏"),o.fullscreen=!0)})),e.offset&&o.screen.mousedown((function(e){o.nes.mmap&&(o.nes.mmap.mousePressed=!0,o.nes.mmap.mouseX=e.pageX-o.screen.offset().left,o.nes.mmap.mouseY=e.pageY-o.screen.offset().top)})).mouseup((function(){setTimeout((function(){o.nes.mmap&&(o.nes.mmap.mousePressed=!1,o.nes.mmap.mouseX=0,o.nes.mmap.mouseY=0)}),500)})),void 0!==t&&o.setRoms(t),o.canvasContext=o.screen[0].getContext("2d"),o.canvasContext.getImageData?(o.canvasImageData=o.canvasContext.getImageData(0,0,256,240),o.resetCanvas(),e(document).bind("keydown",(function(e){o.nes.keyboard.keyDown(e)})).bind("keyup",(function(e){o.nes.keyboard.keyUp(e)})).bind("keypress",(function(e){o.nes.keyboard.keyPress(e)})),o.dynamicaudio=new DynamicAudio({swf:s.opts.swfPath+"dynamicaudio.swf"})):n.html("Your browser doesn't support writing pixels directly to the <code>&lt;canvas&gt;</code> tag. Try the latest versions of Google Chrome, Safari, Opera or Firefox!")):n.html("Your browser doesn't support the <code>&lt;canvas&gt;</code> tag. Try Google Chrome, Safari, Opera or Firefox!")};return s.prototype={loadROM:function(){var t=this;t.updateStatus("Downloading..."),e.ajax({url:escape(t.romSelect.val()),xhr:function(){var n=e.ajaxSettings.xhr();return void 0!==n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),t.xhr=n,n},complete:function(e,n){var s;if(JSNES.Utils.isIE()){var o=JSNESBinaryToArray(e.responseBody).toArray();s=String.fromCharCode.apply(void 0,o)}else s=e.responseText;t.nes.loadRom(s),t.nes.start(),t.enable()}})},resetCanvas:function(){this.canvasContext.fillStyle="black",this.canvasContext.fillRect(0,0,256,240);for(var e=3;e<this.canvasImageData.data.length-3;e+=4)this.canvasImageData.data[e]=255},screenshot:function(){var e=this.screen[0].toDataURL("image/png"),t=new Image;return t.src=e,t},enable:function(){this.buttons.pause.attr("disabled",null),this.nes.isRunning?this.buttons.pause.attr("value","暂停"):this.buttons.pause.attr("value","继续"),this.buttons.restart.attr("disabled",null),this.nes.opts.emulateSound?this.buttons.sound.attr("value","关闭声音"):this.buttons.sound.attr("value","打开声音")},updateStatus:function(e){this.status.text(e)},setRoms:function(t){for(var n in this.romSelect.children().remove(),e("<option>选择游戏版本...</option>").appendTo(this.romSelect),t)if(t.hasOwnProperty(n)){for(var s=e("<optgroup></optgroup>").attr("label",n),o=0;o<t[n].length;o++)e("<option>"+t[n][o][0]+"</option>").attr("value",t[n][o][1]).appendTo(s);this.romSelect.append(s)}},writeAudio:function(e){return this.dynamicaudio.writeInt(e)},writeFrame:function(e,t){var n,s,o,a=this.canvasImageData.data;for(s=0;s<61440;s++)(n=e[s])!=t[s]&&(a[o=4*s]=255&n,a[o+1]=n>>8&255,a[o+2]=n>>16&255,t[s]=n);this.canvasContext.putImageData(this.canvasImageData,0,0)},enterFullscreen:function(){var e=this.screen[0];e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen(),e.style.width="100%",e.style.height="100%"},exitFullscreen:function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),this.screen[0].style.width="256px",this.screen[0].style.height="240px"}},s}}(jQuery);